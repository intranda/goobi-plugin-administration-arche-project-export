<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:section="http://goobi.io/section"
    xmlns:form="http://goobi.io/form"
    xmlns:util="http://goobi.io/util">
    <h:panelGroup>
        <h:panelGroup
            rendered="#{!LoginForm.hasRole('Plugin_administration_arche_project_export')}"
            styleClass="alert alert-danger"
            layout="block">
            #{msgs.plugin_administration_missingPermission} Plugin_administration_arche_project_export
        </h:panelGroup>

        <ui:fragment rendered="#{LoginForm.hasRole('Plugin_administration_arche_project_export')}">
            <!-- select project to export -->
            <section:section type="primary">
                <section:header
                    icon="plug"
                    title="#{msgs[AdministrationForm.administrationPlugin.title]}" />
                <h:form id="actionForm">
                    <section:body>
                        <form:field
                            label="#{msgs.projekt}"
                            help="#{msgs.helpProcessProject}">
                            <h:selectOneMenu
                                id="project"
                                styleClass="form-select"
                                value="#{AdministrationForm.administrationPlugin.projectId}">
                                <f:selectItem itemLabel="#{msgs.bitteAuswaehlen}" itemValue="" />
                                <f:selectItems
                                    value="#{AdministrationForm.administrationPlugin.possibleProjects}"
                                    var="var"
                                    itemLabel="#{var.titel}"
                                    itemValue="#{var.id}" />
                                <f:ajax render="@all" />
                            </h:selectOneMenu>
                        </form:field>
                    </section:body>
                </h:form>
            </section:section>

            <!-- display selected project and edit configured properties -->
            <h:panelGroup
                rendered="#{AdministrationForm.administrationPlugin.selectedProject != null}"
                layout="block"
                styleClass="mt-3">
                <section:section type="action">
                    <section:header
                        icon="plug"
                        title="#{msgs.projektBearbeiten}" />
                    <h:form id="editForm">
                        <section:body>
                            <!-- project title data -->
                            <form:field
                                label="#{msgs.projekt}"
                                help="#{msgs.helpProcessTitle}">
                                <h:inputText
                                    id="title"
                                    styleClass="form-control"
                                    value="#{AdministrationForm.administrationPlugin.selectedProject.titel}"
                                    readonly="true" />
                            </form:field>

                            <form:field
                                label="#{msgs.project_projectIdentifier}"
                                help="#{msgs.help_project_projectIdentifier}">
                                <h:inputText
                                    id="projectIdentifier"
                                    styleClass="form-control"
                                    value="#{AdministrationForm.administrationPlugin.selectedProject.projectIdentifier}"
                                    readonly="true" />
                            </form:field>

                            <form:field
                                label="#{msgs.institution}"
                                help="#{msgs.helpProjectInstitution}">
                                <h:inputText
                                    id="institution"
                                    styleClass="form-control"
                                    value="#{AdministrationForm.administrationPlugin.selectedProject.institution.shortName}"
                                    readonly="true" />
                            </form:field>

                            <!-- number of pages -->
                            <form:field
                                label="#{msgs.numberImages}"
                                help="#{msgs.helpNumberImages}">
                                <h:inputText
                                    id="numberImages"
                                    styleClass="form-control"
                                    value="#{AdministrationForm.administrationPlugin.selectedProject.numberOfPages}"
                                    readonly="true" />
                            </form:field>

                            <!-- number of volumes -->
                            <form:field
                                label="#{msgs.numberVolumes}"
                                help="#{msgs.helpNumberVolumes}">
                                <h:inputText
                                    id="numberVolumes"
                                    styleClass="form-control"
                                    value="#{AdministrationForm.administrationPlugin.selectedProject.numberOfVolumes}"
                                    readonly="true" />
                            </form:field>

                            <form:field label="#{msgs.startdate}">
                                <h:inputText
                                    id="startDate"
                                    styleClass="form-control"
                                    value="#{AdministrationForm.administrationPlugin.selectedProject.startDate}"
                                    readonly="true"
                                    disabled="true">
                                    <f:convertDateTime pattern="yyyy-MM-dd" />
                                </h:inputText>
                            </form:field>

                            <form:field label="#{msgs.enddate}">
                                <h:inputText
                                    id="endDate"
                                    styleClass="form-control"
                                    value="#{AdministrationForm.administrationPlugin.selectedProject.endDate}"
                                    readonly="true"
                                    disabled="true">
                                    <f:convertDateTime pattern="yyyy-MM-dd" />
                                </h:inputText>
                            </form:field>

                            <!--  display configured properties -->
                            <ui:repeat
                                var="property"
                                value="#{AdministrationForm.administrationPlugin.displayProperties}">

                                <ui:fragment rendered="#{property.type.name == 'text'}">
                                    <form:field
                                        label="#{msgs[property.name]}"
                                        help="#{msgs.helpPropertyValue}">
                                        <h:inputText
                                            id="value"
                                            styleClass="form-control"
                                            value="#{property.value}" />
                                    </form:field>
                                </ui:fragment>

                                <ui:fragment rendered="#{property.type.name == 'textarea'}">
                                    <form:field
                                        label="#{property.name}"
                                        help="#{msgs.helpPropertyValue}"
                                        required="#{property.showProcessGroupAccessCondition == 'WRITEREQUIRED'}">
                                        <h:inputTextarea
                                            id="textareaValue"
                                            rows="7"
                                            styleClass="form-control"
                                            value="#{property.value}"
                                            readonly="#{property.showProcessGroupAccessCondition == 'READ'}" />
                                        <h:message
                                            for="textareaValue"
                                            showDetail="true"
                                            styleClass="help-inline font-danger" />
                                    </form:field>
                                </ui:fragment>

                                <ui:fragment rendered="#{property.type.name == 'list'}">
                                    <form:field
                                        label="#{property.name}"
                                        required="#{property.showProcessGroupAccessCondition == 'WRITEREQUIRED'}">
                                        <h:selectOneMenu
                                            id="selectList"
                                            styleClass="form-select"
                                            disabled="#{property.showProcessGroupAccessCondition == 'READ'}"
                                            value="#{property.value}">
                                            <f:selectItems
                                                value="#{property.possibleValues}"
                                                var="val"
                                                itemLabel="#{msgs[val.label]}"
                                                itemValue="#{val.value}" />
                                        </h:selectOneMenu>
                                    </form:field>
                                </ui:fragment>

                                <ui:fragment rendered="#{property.type.name == 'vocabularyreference'}">
                                    <form:field
                                        label="#{property.name}"
                                        required="#{property.showProcessGroupAccessCondition == 'WRITEREQUIRED'}">
                                        <div class="input-group">
                                            <h:selectOneMenu
                                                id="selectVocab"
                                                styleClass="form-select"
                                                disabled="#{property.showProcessGroupAccessCondition == 'READ'}"
                                                value="#{property.value}">
                                                <f:selectItems
                                                    value="#{property.possibleValues}"
                                                    var="val"
                                                    itemLabel="#{msgs[val.label]}"
                                                    itemValue="#{val.value}" />
                                            </h:selectOneMenu>
                                            <button
                                                jsf:action="#{AdministrationForm.administrationPlugin.updateVocabulary(property)}"
                                                title="#{msgs.plugin_administration_arche_updateVocabulary}"
                                                class="btn btn-outline-secondary">
                                                <util:icon icon="refresh" />
                                            </button>
                                        </div>
                                    </form:field>
                                </ui:fragment>

                                <ui:fragment rendered="#{property.type.name == 'boolean'}">
                                    <form:field
                                        label="#{property.name}"
                                        help="#{msgs.helpPropertyValue}"
                                        required="#{property.showProcessGroupAccessCondition == 'WRITEREQUIRED'}">
                                        <h:selectBooleanCheckbox
                                            id="boolean"
                                            value="#{property.booleanValue}"
                                            disabled="#{property.showProcessGroupAccessCondition == 'READ'}" />
                                        <h:message
                                            for="boolean"
                                            showDetail="true"
                                            styleClass="help-inline font-danger" />
                                    </form:field>
                                </ui:fragment>

                                <ui:fragment rendered="#{property.type.name == 'date'}">
                                    <form:field
                                        label="#{property.name}"
                                        help="#{msgs.helpPropertyValue}"
                                        required="#{property.showProcessGroupAccessCondition == 'WRITEREQUIRED'}">
                                        <p:calendar
                                            id="date"
                                            value="#{property.dateValue}"
                                            locale="#{SpracheForm.locale}"
                                            styleClass="ff-goobi"
                                            mask="true"
                                            navigator="true"
                                            yearRange="-100:+100"
                                            pattern="#{property.pattern}">
                                            <f:passThroughAttribute
                                                name="autocomplete"
                                                value="off" />
                                        </p:calendar>
                                        <h:message
                                            for="date"
                                            showDetail="true"
                                            styleClass="help-inline font-danger" />
                                    </form:field>
                                </ui:fragment>
                            </ui:repeat>
                        </section:body>
                        <section:footer>
                            <button
                                jsf:action="#{AdministrationForm.administrationPlugin.exportProject(true)}"
                                aria-label="#{msgs.plugin_administration_arche_save_test}"
                                class="btn btn-success">
                                <util:icon-text icon="device-floppy" text="#{msgs.plugin_administration_arche_save_test}" />
                            </button>
                            <button
                                jsf:action="#{AdministrationForm.administrationPlugin.exportProject(false)}"
                                aria-label="#{msgs.plugin_administration_arche_save_prod}"
                                class="btn btn-success">
                                <util:icon-text icon="device-floppy" text="#{msgs.plugin_administration_arche_save_prod}" />
                            </button>
                        </section:footer>
                    </h:form>
                </section:section>
            </h:panelGroup>
        </ui:fragment>
    </h:panelGroup>
</ui:composition>
